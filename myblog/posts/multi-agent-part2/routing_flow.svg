<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 450 570" font-family="system-ui, -apple-system, sans-serif">
  <!-- Arrowhead markers -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748B"/>
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#22C55E"/>
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#DC2626"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="450" height="570" fill="#ffffff"/>

  <!-- Title -->
  <text x="225" y="25" text-anchor="middle" font-size="16" font-weight="600" fill="#1a1a1a">Task Routing Flow</text>

  <!-- Input: Agent returns HandoffResult -->
  <rect x="100" y="45" width="250" height="35" rx="6" fill="#F3E8FF" stroke="#8B5CF6" stroke-width="2"/>
  <text x="225" y="67" text-anchor="middle" font-size="10" font-weight="600" fill="#5B21B6">Agent returns HandoffResult</text>

  <!-- Arrow -->
  <path d="M225 80 L225 100" stroke="#64748B" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Routing Decision Box -->
  <rect x="75" y="105" width="300" height="55" rx="6" fill="#FEF3C7" stroke="#F59E0B" stroke-width="2"/>
  <text x="225" y="128" text-anchor="middle" font-size="11" font-weight="600" fill="#92400E">ROUTING DECISION</text>
  <text x="225" y="145" text-anchor="middle" font-size="9" fill="#78350F">LLMIntentRouter: "Which agent handles this?"</text>

  <!-- Arrow -->
  <path d="M225 160 L225 180" stroke="#64748B" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Task Creation -->
  <rect x="75" y="185" width="300" height="40" rx="4" fill="#F1F5F9" stroke="#64748B" stroke-width="1.5"/>
  <text x="225" y="205" text-anchor="middle" font-size="10" font-weight="600" fill="#475569">TASK CREATION</text>
  <text x="225" y="219" text-anchor="middle" font-size="9" fill="#64748B">Task(routed_to="transcript", intent="...")</text>

  <!-- Arrow -->
  <path d="M225 225 L225 245" stroke="#64748B" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Task Queue -->
  <rect x="75" y="250" width="300" height="40" rx="6" fill="#DCFCE7" stroke="#22C55E" stroke-width="3"/>
  <text x="225" y="275" text-anchor="middle" font-size="12" font-weight="600" fill="#166534">TASK QUEUE</text>

  <!-- Arrow -->
  <path d="M225 290 L225 310" stroke="#64748B" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <text x="235" y="305" font-size="8" fill="#666666" font-style="italic">event</text>

  <!-- Agent Watchers Box -->
  <rect x="50" y="315" width="350" height="95" rx="6" fill="#F3E8FF" stroke="#8B5CF6" stroke-width="2"/>
  <text x="225" y="335" text-anchor="middle" font-size="11" font-weight="600" fill="#5B21B6">AGENT WATCHERS (all wake up)</text>

  <!-- Agent checks -->
  <text x="70" y="357" font-size="9" fill="#666666">SearchAgent:</text>
  <text x="160" y="357" font-size="9" fill="#666666">routed_to == "search"?</text>
  <text x="305" y="357" font-size="9" font-weight="600" fill="#DC2626">NO</text>

  <text x="70" y="373" font-size="9" fill="#666666">TranscriptAgent:</text>
  <text x="160" y="373" font-size="9" fill="#666666">routed_to == "transcript"?</text>
  <text x="305" y="373" font-size="9" font-weight="600" fill="#22C55E">YES ‚Üê</text>

  <text x="70" y="389" font-size="9" fill="#666666">SummarizeAgent:</text>
  <text x="160" y="389" font-size="9" fill="#666666">routed_to == "summarize"?</text>
  <text x="305" y="389" font-size="9" font-weight="600" fill="#DC2626">NO</text>

  <text x="225" y="405" text-anchor="middle" font-size="8" fill="#8B5CF6" font-style="italic">(Simple string comparison - no LLM)</text>

  <!-- Arrow -->
  <path d="M225 410 L225 430" stroke="#64748B" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Validation Box -->
  <rect x="50" y="435" width="350" height="80" rx="6" fill="#FEF3C7" stroke="#F59E0B" stroke-width="2"/>
  <text x="225" y="455" text-anchor="middle" font-size="11" font-weight="600" fill="#92400E">VALIDATION (safety net)</text>
  <text x="225" y="472" text-anchor="middle" font-size="9" fill="#78350F">TranscriptAgent.validate_assignment(task)</text>
  <text x="225" y="486" text-anchor="middle" font-size="9" fill="#78350F">"Am I really the right agent?" (LLM call)</text>

  <!-- Accept arrow (green) pointing down -->
  <path d="M150 515 L150 555" stroke="#22C55E" stroke-width="2" marker-end="url(#arrowhead-green)"/>
  <text x="120" y="510" font-size="9" font-weight="600" fill="#22C55E">ACCEPT</text>
  <text x="150" y="565" text-anchor="middle" font-size="9" fill="#22C55E">execute</text>

  <!-- Reject arrow (red) curving back to routing decision -->
  <path d="M320 515 L320 530 Q320 540 330 540 L420 540 Q430 540 430 530 L430 130 Q430 120 420 120 L385 120"
        stroke="#DC2626" stroke-width="2" fill="none" marker-end="url(#arrowhead-red)"/>
  <text x="320" y="510" font-size="9" font-weight="600" fill="#DC2626">REJECT</text>
  <text x="435" y="340" font-size="9" fill="#DC2626" transform="rotate(90, 435, 340)">re-route</text>

</svg>
